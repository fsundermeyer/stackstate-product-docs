= Démarrer avec Open Telemetry
:revdate: 2025-07-10
:page-revdate: {revdate}
:description: SUSE Observability

Voici la configuration que nous allons créer, pour une application qui doit être surveillée :

* L'application / charge de travail surveillée fonctionnant sur un hôte Linux
* Le collecteur Open Telemetry fonctionnant sur le même hôte Linux
* SUSE Observability ou SUSE Cloud Observability

image::otel/open-telemetry-collector-linux.png[Instrumentation d'une application sur un hôte linux avec le collecteur Open Telemetry fonctionnant sur l'hôte]

== Installer le collecteur Open Telemetry

[NOTE]
====
Pour une configuration de production, il est fortement recommandé d'installer le collecteur, car il permet à votre service de décharger rapidement les données et le collecteur peut prendre en charge des tâches supplémentaires telles que les tentatives, la mise en lots, le cryptage ou même le filtrage des données sensibles.
====


Nous allons d'abord installer le collecteur. Nous le configurons pour :

* Recevoir des données provenant d'un grand nombre d'applications instrumentées
* Enrichir les données collectées avec les attributs de l'hôte
* Générer des métriques pour les traces
* Transmettre les données à SUSE Observability, y compris l'authentification à l'aide de la clé API

En outre, il réessaie d'envoyer des données en cas de problème de connexion.

=== Créer un jeton de service

Il existe deux façons de créer un jeton de service :

* **SUSE Observability UI** - ouvrez le menu principal en cliquant en haut à gauche de l'écran et allez à `StackPacks` > `Open Telemetry`.  Si vous ne l'avez pas encore fait, cliquez sur le bouton `INSTALL`.  Cliquez sur le bouton `CREATE NEW SERVICE TOKEN` et copiez la valeur dans votre presse-papiers.
* **SUSE Observability CLI** - voir xref:/use/security/k8s-service-tokens.adoc#_manage_service_tokens[Gérer les jetons de service]

La valeur du jeton de service doit être utilisée lorsque les instructions ci-dessous mentionnent `<SERVICE_TOKEN>`.

=== Installation et configuration du collecteur

Le collecteur fournit des paquets (apk, deb et rpm) pour la plupart des versions et architectures Linux et utilise `systemd` pour la configuration automatique des services. Pour l'installer, trouvez la https://github.com/open-telemetry/opentelemetry-collector-releases/releases[dernière version de] et mettez à jour l'URL dans l'exemple pour utiliser la dernière version :

[tabs]
====
DEB AMD64::
+
--

[,bash]
----
wget https://github.com/open-telemetry/opentelemetry-collector-releases/releases/download/v0.123.1/otelcol-contrib_0.123.1_linux_amd64.deb
sudo dpkg -i otelcol-contrib_0.123.1_linux_amd64.deb
----

--
DEB ARM64::
+
--

[,bash]
----
wget https://github.com/open-telemetry/opentelemetry-collector-releases/releases/download/v0.123.1/otelcol-contrib_0.123.1_linux_arm64.deb
sudo dpkg -i otelcol-contrib_0.123.1_linux_arm64.deb
----

--
RPM AMD64::
+
--

[,bash]
----
wget https://github.com/open-telemetry/opentelemetry-collector-releases/releases/download/v0.123.1/otelcol-contrib_0.123.1_linux_amd64.rpm
sudo rpm -iv1 otelcol-contrib_0.123.1_linux_amd64.rpm
----

--
RPM ARM64::
+
--

[,bash]
----
wget https://github.com/open-telemetry/opentelemetry-collector-releases/releases/download/v0.123.1/otelcol-contrib_0.123.1_linux_arm64.rpm
sudo rpm -iv1 otelcol-contrib_0.123.1_linux_arm64.rpm
----

--
====

Pour d'autres options d'installation, consultez les https://opentelemetry.io/docs/collector/installation/#_linux[instructions de].

Après l'installation, modifiez la configuration du collecteur en éditant `/etc/otelcol-contrib/config.yaml`. Modifiez le fichier de manière à ce qu'il ressemble à l'exemple `config.yaml`, remplacez `<otlp-suse-observability-endpoint:port>` par votre point de terminaison OTLP (voir xref:/setup/otel/otlp-apis.adoc[API OTLP] pour votre point de terminaison) et insérez votre jeton de service pour `<SERVICE_TOKEN>`:

.config.yaml
[,yaml]
----
receivers:
  otlp:
    protocols:
      # Only bind to localhost to keep the collector secure, see https://github.com/open-telemetry/opentelemetry-collector/blob/main/docs/security-best-practices.md#safeguards-against-denial-of-service-attacks
      grpc:
        endpoint: 127.0.0.1:4317
      http:
        endpoint: 127.0.0.1:4318
  # Collect own metrics
  prometheus:
    config:
      scrape_configs:
      - job_name: 'otel-collector'
        scrape_interval: 10s
        static_configs:
        - targets: ['0.0.0.0:8888']
extensions:
  health_check: {}
  pprof:
    endpoint: 0.0.0.0:1777
  zpages:
    endpoint: 0.0.0.0:55679
  # Use the API key from the env for authentication
  bearertokenauth:
    scheme: SUSEObservability
    token: "<SERVICE_TOKEN>"
exporters:
  nop: {}
  debug: {}
  otlp/suse-observability:
    compression: snappy
    auth:
      authenticator: bearertokenauth
    # Put in your own otlp endpoint, for example otlp-suse-observability.my.company.com:443
    endpoint: <otlp-suse-observability-endpoint:port>
processors:
  memory_limiter:
    check_interval: 5s
    limit_percentage: 80
    spike_limit_percentage: 25
  batch: {}
  # Optionally include resource information from the system running the collector
  resourcedetection/system:
    detectors: [env, system] # Replace system with gcp, ec2, azure when running in cloud environments
    system:
      hostname_sources: ["os"]
connectors:
  # Generate metrics for spans
  spanmetrics:
    metrics_expiration: 5m
    namespace: otel_span
service:
  extensions: [ bearertokenauth, health_check, pprof, zpages ]
  pipelines:
    traces:
      receivers: [otlp]
      processors: [memory_limiter, resourcedetection/system, batch]
      exporters: [debug, spanmetrics, otlp/suse-observability]
    metrics:
      receivers: [otlp, spanmetrics, prometheus]
      processors: [memory_limiter, batch, resourcedetection/system]
      exporters: [debug, otlp/suse-observability]
    logs:
      receivers: [otlp]
      processors: []
      exporters: [nop]
----


Enfin, redémarrez le collecteur :

[,bash]
----
sudo systemctl restart otelcol-contrib
----

Pour voir les journaux du collecteur, utilisez :

[,bash]
----
sudo journalctl -u otelcol-contrib
----

== Collecte de données télémétriques à partir de votre application

La façon la plus courante de collecter des données de télémétrie est d'instrumenter votre application à l'aide du SDK Open Telemetry. Nous avons rédigé des guides de démarrage rapide pour quelques langues, mais il en existe beaucoup d'autres :

* xref:/setup/otel/instrumentation/java.adoc[Java]
* xref:/setup/otel/instrumentation/dot-net.adoc[.NET]
* xref:/setup/otel/instrumentation/node.js.adoc[Node.js]

Aucune configuration supplémentaire n'est nécessaire pour les SDK, qui exportent par défaut vers localhost via OTLP ou OTLP over HTTP (en fonction des protocoles pris en charge).

Pour les autres langues, suivez la documentation sur https://opentelemetry.io/docs/languages/[opentelemetry.io].

== Voir les résultats

Allez sur SUSE Observability et assurez-vous que le Stackpack Open Telemetry est installé (via le menu principal \-> Stackpacks).

Après un court instant et si votre application traite du trafic, vous devriez pouvoir la trouver sous son nom de service dans les aperçus Open Telemetry \-> services et instances de service. Les traces apparaissent dans l'xref:/use/traces/k8sTs-explore-traces.adoc[explorateur de traces] et dans la xref:/use/views/k8s-traces-perspective.adoc[perspective de traces] pour les composants service et instance de service. Les métriques de portée et les métriques spécifiques à la langue (le cas échéant) seront disponibles dans la xref:/use/views/k8s-metrics-perspective.adoc[perspective des métriques] pour les composants.

== Prochaines étapes

ifdef::ss-ff-stackpacks2_enabled[]
Vous pouvez ajouter de nouveaux graphiques aux composants, par exemple le service ou l'instance de service, pour votre application, en suivant xref:/setup/custom-integrations/metric-bindings/index.adoc[notre guide.] Il est également possible de créer de xref:/use/alerting/k8s-monitors.adoc[nouveaux moniteurs] à l'aide des métriques et de configurer des xref:/use/alerting/notifications/configure.adoc[notifications] afin d'être informé lorsque votre application n'est pas disponible ou qu'elle présente des problèmes de performance.
endif::[]

ifndef::ss-ff-stackpacks2_enabled[]
Vous pouvez ajouter de nouveaux graphiques aux composants, par exemple le service ou l'instance de service, pour votre application, en suivant xref:/use/metrics/k8s-add-charts.adoc[notre guide.] Il est également possible de créer de xref:/use/alerting/k8s-monitors.adoc[nouveaux moniteurs] à l'aide des métriques et de configurer des xref:/use/alerting/notifications/configure.adoc[notifications] afin d'être informé lorsque votre application n'est pas disponible ou qu'elle présente des problèmes de performance.
endif::[]

== Plus d'informations

* xref:/use/security/k8s-service-tokens.adoc[Jetons de service]
* xref:/setup/otel/otlp-apis.adoc[API de télémétrie ouverte]
* xref:/setup/otel/collector.adoc[Personnalisation de la configuration du collecteur Open Telemetry]
* xref:/setup/otel/instrumentation/README.adoc[SDK de télémétrie ouverts]
