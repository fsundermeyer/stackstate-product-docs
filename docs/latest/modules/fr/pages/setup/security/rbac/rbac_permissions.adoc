= Permissions
:revdate: 2025-07-10
:page-revdate: {revdate}
:description: SUSE Observability en mode auto-hébergé

== Vue d'ensemble

Les autorisations dans SUSE Observability permettent aux administrateurs de gérer les actions que chaque utilisateur ou groupe d'utilisateurs peut effectuer dans SUSE Observability et les informations qui seront affichées dans l'interface utilisateur de SUSE Observability. Seul l'ensemble des fonctionnalités correspondant au rôle actif de chaque utilisateur sera présenté. Les actions, informations et pages auxquelles un utilisateur n'a pas accès ne sont tout simplement pas affichées dans l'interface utilisateur de SUSE Observability.

[NOTE]
====
Les autorisations sont stockées dans StackGraph. Cela signifie que :

* Si vous effectuez une mise à niveau avec "effacer toutes les données", la configuration des autorisations sera également supprimée.
* Pour supprimer complètement un utilisateur, il faut également le supprimer manuellement de StackGraph.
====


== Permissions de SUSE Observability

Il existe deux types de permission dans SUSE Observability. Les *autorisations système* définissent les capacités de l'utilisateur, telles que l'accès aux paramètres, l'exécution de requêtes et l'écriture de scripts. Les *autorisations définies* déterminent l'accès aux données d'observabilité et à certains types de ressources comme SUSE Observability Views.  Pour les opérations CRUD sur SUSE Observability Views, elles peuvent être accordées pour une vue spécifique ou pour toutes les vues. Pour plus de détails sur les autorisations liées à chaque rôle prédéfini dans SUSE Observability, voir xref:/setup/security/rbac/rbac_roles.adoc#_predefined_roles[rôles prédéfinis].

Les autorisations suivantes sont disponibles dans SUSE Observability :

.Permissions
[cols="2,2,5"]
|===
|Ressources |Verbes |Description

|agents
|obtenir
|Agents connectés

|api-tokens
|obtenir
|Clé API à utiliser pour l'authentification avec le CLI de SUSE Observability.  Il s'agit d'une donnée unique par utilisateur.

|composants-actions
|exécuter
|xref:/use/views/k8s-topology-perspective.adoc#_actions[Actions sur les composants dans la perspective de la topologie].

|liaisons métriques
|obtenir, créer, mettre à jour, supprimer
ifdef::ss-ff-stackpacks2_enabled[]
|xref:/setup/custom-integrations/metric-bindings/index.adoc[Liens permettant de visualiser les données dans la perspective des métriques].
endif::[]
ifndef::ss-ff-stackpacks2_enabled[]
|xref:/use/metrics/k8s-add-charts.adoc[Liens permettant de visualiser les données dans la perspective des métriques].
endif::[]

|métriques
|get\^[1]^, update
|Ingérer et interroger les données métriques à l'aide de PromQL

|moniteurs
|obtenir, créer, mettre à jour, supprimer, exécuter
|xref:/use/alerting/k8s-monitors.adoc[Déterminer l'état des composants à l'aide de moniteurs].

|notifications
|obtenir, créer, mettre à jour, supprimer
|xref:/use/alerting/notifications/configure.adoc[Soyez alerté par des notifications].

|autorisations
|obtenir, mettre à jour
|Gérer les autorisations sur les sujets.

|autorisations restreintes
|update\^[1]^
|Gérer les autorisations de portée, en accordant (ou en révoquant) l'accès à la topologie, aux mesures et aux traces à partir d'une seule grappe.

|scripts
|exécuter
|Exécutez un script dans l'environnement SUSE Observability UI Analytics.

|scripts restreints
|exécuter
|Utiliser le script HTTP et l'API Gremlin graph dans l'environnement Analytics.

|service-token
|obtenir, créer, supprimer
|xref:/use/security/k8s-service-tokens.adoc[Les jetons de service] authentifient un service externe et peuvent être utilisés pour l'ingestion de données.

|paramètres
|obtenir, mettre à jour, déverrouiller
|Exporter ou importer des paramètres ou déverrouiller des xref:/stackpacks/about-stackpacks.adoc#_locked_configuration_items[éléments de configuration verrouillés].

|stackpacks
|obtenir, mettre à jour
|Lister ou télécharger les xref:/stackpacks/about-stackpacks.adoc[sacs à dos].

|stackpack-configurations
|créer, mettre à jour, supprimer
|Gérer les intégrations à l'aide de xref:/stackpacks/about-stackpacks.adoc[Stackpacks].

|sync-data
|obtenir, supprimer
|Inspecter ou réinitialiser les pipelines de synchronisation de la topologie et de l'état de santé.

|system-notifications
|obtenir
|Accéder aux notifications du système dans l'interface utilisateur

|thèmes-messages
|obtenir
|Accéder aux données du SUSE Observability Receiver.

|topologie
|get\^[1]^
|xref:/use/views/k8s-views.adoc[Explorer les vues de la topologie].

|traces
|get\^[1]^
|xref:/use/traces/k8sTs-explore-traces.adoc[Explorer les traces].

|points de vue
|get^[1]^, create, update^[1]^, delete^[1]^
|Utiliser ou gérer des xref:/use/views/k8s-custom-views.adoc[vues personnalisées].

|vues-favorites
|créer, supprimer
|Ajouter et supprimer des étoiles dans les vues.

|visualization
|mise à jour
|Modifier les xref:/use/views/k8s-topology-perspective.adoc#_visualization_settings[paramètres de visualisation].

|===
\^[1]^ Il s'agit d'une *autorisation limitée*, l'interprétation du nom de la ressource dépend du contexte.

=== Permissions encadrées

Vous pouvez accorder certaines autorisations à l'ensemble du système ou les limiter à un sous-ensemble de ressources.  Vous pouvez leur donner un *nom de ressource*, qui indique le champ d'application.  L'interprétation de ce nom dépend du type de ressource.  Notez que le cadrage peut ne s'appliquer qu'à certains verbes.

* `views` - Le nom de la vue
* `topology` - Toute étiquette de composant. Dans un environnement Kubernetes, il peut s'agir, par exemple, de `cluster-name:<cluster-name>` ou de `k8s-scope:<cluster-name>/<namespace>`
* `metrics` - Dans un environnement Kubernetes, soit `k8s:<cluster-name>:\\__any__`, soit `k8s:<cluster-name>:<namespace>`
* `traces` - Dans un environnement Kubernetes, soit `k8s.cluster.name:<cluster-name>`, soit `k8s.scope:<cluster-name>/<namespace>`
* `scoped-permissions` - Le nom du cluster pour lequel les permissions sont gérées

== Gérer les autorisations

Vous pouvez gérer les autorisations de SUSE Observability à l'aide de la CLI `sts`.
Pour les autorisations limitées, un nom de ressource peut être spécifié.  Si aucune autorisation n'est donnée, l'autorisation sera accordée (ou révoquée) à l'ensemble du système.

[NOTE]
====
*Remarque importante :* Toutes les autorisations dans SUSE Observability sont sensibles à la casse.
====


=== Liste de toutes les autorisations disponibles

Liste de toutes les autorisations disponibles :

[,text]
----
sts rbac list-permissions
----

=== Liste de tous les sujets

Énumérer tous les sujets :

[,text]
----
sts rbac describe-subjects

SUBJECT                                    | SOURCE
stackstate-admin                           | Static
suse-observability-instance-admin          | Kubernetes
suse-observability-agent-clusterA          | Observability
----
[NOTE]
====
`+Le sujet `+SOURCE` indique qui possède et gère le sujet. Il peut s'agir de l'une de nos sources RBAC (Configuration|Static, Observability, Kubernetes).

* Configuration|Statique : Sujets obtenus via la configuration de l'observabilité de Suse par l'intermédiaire de helm
* Observabilité : Sujets gérés par le sts cli
* Kubernetes : Sujets obtenus via l'agent RBAC à partir des RoleBindings et ClusterRoleBindings de Kubernetes.
====

=== Liste des sujets pour un utilisateur

Liste de tous les sujets attribués au contexte, la première entrée affichée étant le nom d'utilisateur et les rôles potentiels de l'utilisateur :

[,text]
----
sts user-session roles

user-dkzwh
keycloakoidc_group://suse-observability-instance-troubleshooter
keycloakoidc_group://suse-observability-instance-observer
keycloakoidc_group://suse-observability-cluster-observer
keycloakoidc_group://suse-observability-instance-admin
keycloakoidc_group://suse-observability-observer
----

Liste de tous les sujets attribués à un utilisateur, en indiquant leur `api-token`(utile pour que l'administrateur puisse aider à déboguer les utilisateurs ayant moins de privilèges) :

[,text]
----
sts user-session roles --api-token [api-token]

u-3p775e7w7l
keycloakoidc_group://suse-observability-cluster-observer
----

=== Afficher les autorisations accordées

Affiche les autorisations accordées à un utilisateur ou à un rôle spécifique.

[,text]
----
sts rbac describe-permissions --subject [role-name]

PERMISSION   | RESOURCE
get-topology | cluster-name:rbac-t2
get-traces   | k8s.cluster.name:rbac-t2
get-metrics  | k8s:rbac-t2:__any__
----

[NOTE]
====
`--subject` peut être n'importe quel sujet disponible dans les différentes sources RBAC (Configuration, Observabilité, Kubernetes)
====

=== Octroi des autorisations
[NOTE]
====
`--subject` peut être un sujet d'observabilité, les sujets de configuration et de Kubernetes sont en lecture seule.
====

==== Permettre à un utilisateur d'ouvrir une vue

Donner à un sujet autorisé la possibilité d'ouvrir une vue :

[,text]
----
sts rbac grant --subject [role-name] --permission get-views --resource [view-name]
----

==== Permettre à un utilisateur de créer des vues

Donner à un sujet du système la permission de créer des vues :

[,text]
----
sts rbac grant --subject [role-name] --permission create-views
----

==== Autoriser un utilisateur à vérifier les paramètres de SUSE Observability

Donner à un sujet du système la permission de vérifier les paramètres de SUSE Observability :

[,text]
----
sts rbac grant --subject [role-name] --permission get-settings
----

=== Révoquer les autorisations
[NOTE]
====
`--subject` peut être un sujet d'observabilité, les sujets de configuration et de Kubernetes sont en lecture seule.
====

Révoquer les autorisations d'ouverture d'une vue pour un sujet :

[,text]
----
sts rbac revoke --subject [role-name] --permission get-views --resource [view-name]
----

== SUSE Observability UI sans autorisations

Voici un exemple de l'interface utilisateur de SUSE Observability pour un utilisateur ne disposant d'aucune autorisation :

image::noperm.png[Aucune autorisation]
