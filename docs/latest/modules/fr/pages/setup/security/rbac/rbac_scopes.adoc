= Champs d'application de la topologie
:revdate: 2025-07-10
:page-revdate: {revdate}
:description: SUSE Observability en mode auto-hébergé

WARNING: Le marquage de la topologie par une requête est une fonctionnalité obsolète. Elle est remplacée par l'autorisation `get-topology` qui permet d'accéder à n'importe quel composant avec une étiquette spécifique.

== Comment fonctionnent les scopes topologiques ?

L'étendue de la topologie est une xref:/develop/reference/k8sTs-stql_reference.adoc[requête STQL] qui est combinée avec les permissions `get-topology` en tant que préfixe à chaque requête de topologie exécutée dans SUSE Observability. Lorsqu'un utilisateur souhaite sélectionner une vue ou passer une requête dans SUSE Observability, cette requête préfixe est exécutée dans le cadre de la requête de l'utilisateur. Cela permet de limiter les résultats en fonction du rôle de l'utilisateur.

NOTE: Les appels de fonction tels que `withCauseOf` et `withNeighborsOf` ne sont pas pris en charge car ils ne seraient pas performants dans ce contexte.

Si un utilisateur appartient à plusieurs groupes, il peut avoir plusieurs portées topologiques, ce qui se traduit par plusieurs préfixes. Ici, le préfixe est exécuté comme un OU de tous les champs d'application topologiques dont dispose l'utilisateur.

Les utilisateurs doivent se déconnecter et s'authentifier à nouveau auprès de SUSE Observability chaque fois que leurs rôles ou leurs autorisations changent.

== Pourquoi des scopes topologiques ?

Les champs d'application de la topologie sont une fonctionnalité de sécurité pour les sujets au sein de SUSE Observability. Les rôles prédéfinis SUSE Observability Administrator, Power User et Guest n'ont pas de portée topologique définie.

Il est possible de spécifier l'étendue d'une topologie en tant que caractère générique de la requête, mais cela permet d'accéder à tout et n'est pas recommandé. S'il est nécessaire d'avoir un accès sans périmètre topologique, il est recommandé d'utiliser l'un des xref:/setup/security/rbac/rbac_permissions.adoc#_predefined_roles[rôles prédéfinis] à la place.

== Exemples

L'exemple ci-dessous montre la même vue de la topologie appelée "Toute l'infrastructure" pour quatre utilisateurs ayant des niveaux d'autorisation différents.

=== Cet utilisateur fait partie du groupe SUSE Observability Admin, il n'y a donc pas d'étendue topologique :

image::v51_allperm.png[Permissions d'affichage complet]

La requête pour cette vue est la même que pour les autres, mais sans préfixe :

[,text]
----
'layer = "Infrastructure" AND domain IN ("Customer1", "Customer2")'
----

=== L'utilisateur ci-dessous fait partie d'un groupe dont le sujet X est configuré avec la portée topologique suivante :

[,text]
----
'domain = "Customer1"'
----

image::v51_esx1perm.png[Vue limitée]

La requête avec le préfixe pour cette vue est :

[,text]
----
'(domain = "Customer1") AND (layer = "Infrastructure" AND domain IN ("Customer1", "Customer2"))'
----

=== Un autre utilisateur qui fait partie d'un groupe avec un sujet configuré Y qui a l'étendue topologique suivante :

[,text]
----
'domain = "Customer2"'
----

obtient cette topologie :

image::v51_esx2perm.png[Vue limitée]

La requête avec le préfixe pour cette vue est :

[,text]
----
'(domain = "Customer2") AND (layer = "Infrastructure" AND domain IN ("Customer1", "Customer2"))'
----

=== Utilisateur avec plusieurs préfixes

Il est possible d'affecter un sujet à plusieurs groupes. Dans cet exemple, vous pouvez voir un gestionnaire d'infrastructure qui peut voir l'ensemble de la vue présentée ci-dessus. Cet utilisateur doit faire partie des deux groupes dont les sujets configurés sont X et Y. Dans ce cas, le préfixe de la requête de l'utilisateur ressemblera à ce qui suit :

[,text]
----
'(domain = "Customer1" OR domain = "Customer2")'
----

La requête avec préfixe pour cet utilisateur est alors :

[,text]
----
'(domain = "Customer1" OR domain = "Customer2") AND (layer = "Infrastructure" AND domain IN ("Customer1", "Customer2"))'
----

Ce qui donne la vue suivante :

image::v51_allperm.png[Permissions d'affichage complet]
